---
import Layout from "../layout/Layout.astro";
import MallaCurricular from "../sections/MallaCurricular.astro";
import Acordeon from "../components/Acordeon.astro";
import PictureImg from "@/components/atoms/PictureImg.astro";
import Typografic from "../components/Typografic.astro";
import { getCollection } from "astro:content";
import Banner from "@/components/moleculs/Banner.astro";
import Button from "@/components/Button.astro";
import SplitLayout from "@/components/moleculs/SplitLayout.astro";
import FormBanner from "@/components/organisms/FormBanner.astro";

export async function getStaticPaths() {
    const colectionCurso = await getCollection('curso');

    return colectionCurso.map((curso) => {
        return {
            params: { curso: curso.id },
            props: curso.data,
        };
    });
}

const { descripcion, titulo, images, modulos, imagenesBanner } = Astro.props;

---

<Layout titulo={titulo} descripction={descripcion}>
    <link
        slot="preload"
        fetchpriority="high"
        rel="preload"
        as="image"
        href=`/img/${imagenesBanner.imagen}-small-lcpi.avif`
        media="(max-width: 640px)"
        type="image/webp"
    />
    <link
        slot="preload"
        fetchpriority="high"
        rel="preload"
        as="image"
        href=`/img/${imagenesBanner.imagen}-large-lcpi.avif`
        media="(min-width: 641px)"
        type="image/webp"
    />
    <Banner {imagenesBanner}>
        <SplitLayout variant="banner" colors="white" style="position: relative; padding-block: 2.5rem;" align="center" classUtilities="@md:text-left" >
            <article class="banner__contenido textFlow">
                <Typografic as="h1" size="superTitle" weigth="700">{titulo}</Typografic>
                <Typografic as="p">{descripcion}</Typografic>
                <Button
                    href="https://api.whatsapp.com/send/?phone=51980816746&text=%C2%A1Hola%21+%EF%BF%BD+Mas+informaci%C3%B3n&type=phone_number&app_absent=0"
                    target="_blank"
                    variant="theme2">Mas Informaci√≥n</Button
                >
            </article>
            <FormBanner />
        </SplitLayout>
    </Banner>

    <MallaCurricular>
        {
            modulos.map(({ id, semanas }, i) => {
                return (
                    <>
                        <Typografic
                            as="h3"
                            weigth="700"
                            variant="colorBlue"
                            style="padding-block: 1rem;"
                        >{`Modulo ${i + 1} : ${id}`}</Typografic>
                        {semanas.map((semana, index) => {
                            return (
                                <Acordeon
                                    numModulo={index + 1}
                                    modulo={id}
                                    semanas={semana.temas}
                                />
                            );
                        })}
                    </>
                );
            })
        }

        <PictureImg 
            slot="Poster"
            class="Poster"
            placeholder={images.placeholder}
            original={images.original}

        />
    </MallaCurricular>
</Layout>

<style lang="scss">
    .Poster {
        grid-area: poster;
        align-self: start;
        position: sticky;
        top: var(--header-heigth);
        overflow: hidden;
        border-radius: 0.5rem;
    }
</style>
